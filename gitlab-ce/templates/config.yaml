apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ template "fullname" . }}
  labels:
    app: {{ template "fullname" . }}
    chart: "{{ .Chart.Name }}-{{ .Chart.Version }}"
    release: "{{ .Release.Name }}"
    heritage: "{{ .Release.Service }}"
data:
  # DB config
  db.type: {{ .Values.db.type }}
  db.host: {{ .Values.db.host }}
  db.name: {{ .Values.db.db }}
  db.user: {{ .Values.db.user }}
  db.pass: {{ .Values.db.pass }}

  # SMTP settings
  smtp.enabled: "{{ .Values.gitlab.smtp.enabled }}"
  smtp.domain: {{ .Values.gitlab.smtp.domain }}
  smtp.host: {{ .Values.gitlab.smtp.host }}
  smtp.user: {{ .Values.gitlab.smtp.user }}
  smtp.pass: {{ .Values.gitlab.smtp.pass }}
  smtp.port: "{{ .Values.gitlab.smtp.port }}"

  # Redis settings
  redis.host: {{ template "redis.fullname" . }}
  redis.port: "6379"
  redis.password: "{{ .Values.redis.redisPassword }}"

  # SSH settings
  gitlab.ssh.host: {{ .Values.gitlab.ssh.host }}
  gitlab.ssh.port: "{{ .Values.gitlab.ssh.port }}"

  # SSL settings
  gitlab.ssl: "{{ .Values.gitlab.ssl.enabled }}"
  gitlab.ssl.hsts.enabled: "{{ .Values.gitlab.ssl.hsts }}"

  # GitLab settings
  gitlab.port: "{{ .Values.gitlab.port }}"
  gitlab.host: {{ .Values.gitlab.host }}
  gitlab.email: {{ .Values.gitlab.email }}
  gitlab.timezone: {{ .Values.gitlab.timezone }}
  gitlab.backup.schedule: {{ .Values.gitlab.backup.schedule }}
  gitlab.backup.expiry: "{{ .Values.gitlab.backup.expiry }}"
  gitlab.backup.aws.backups: "{{ .Values.gitlab.backup.aws.backups }}"
  gitlab.backup.aws.region: {{ .Values.gitlab.backup.aws.region }}
  gitlab.backup.aws.bucket: {{ .Values.gitlab.backup.aws.bucket }}
  gitlab.backup.aws.access-key-id: "{{ .Values.gitlab.backup.aws.accessKeyId }}"
  gitlab.backup.aws.secret-access-key: "{{ .Values.gitlab.backup.aws.secretAccessKey }}"

  # Secrets
  gitlab.secrets.rootPassword: {{ .Values.gitlab.secrets.rootPassword }}
  gitlab.secrets.sessionKeyBase: "{{ .Values.gitlab.secrets.sessionKeyBase }}"
  gitlab.secrets.dbKeyBase: "{{ .Values.gitlab.secrets.dbKeyBase }}"
  gitlab.secrets.secretKeyBase: "{{ .Values.gitlab.secrets.secretKeyBase }}"
  gitlab.secrets.otpKeyBase: "{{ .Values.gitlab.secrets.otpKeyBase }}"
